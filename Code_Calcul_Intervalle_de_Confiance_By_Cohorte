
### En utilisant les programmes Code_Simulation_pour_Intervalle_de_Confiance, Code_Esperance_de_vie_Intervalle_de_Confiance et Code_Prevalence_Intervalle_de_Confiance

## Objectif : récupérer les intervalles de confiance par âge des espérances de vie à 35 ans, des prévalences et taux de prévalence.

# esperance_de_vie : matrice 200 lignes, 2 colonnes. Avec les espérances de vie à 35 ans pour chaque itérations de la cohorte de la cohorte simulé
# esperance_de_vie_bonne_sante : matrice 200 lignes, 2 colonnes. Avec les espérances de vie en bonne santé à 35 ans pour chaque itérations de la cohorte simulé
# PREV : matrice 61 lignes, 200 colonnes. Avec les âges en lignes et la prévalence par âge en colonne pour chaque itération
# SUMMARY_PREV : matrice 61 lignes et 4 colonnes. Avec l'âge en ligne et les quantiles à 2,5%, à 97,5% et la moyenne pour les prévalences en colonne pour chaque âge
# TX_PREV : matrice de 61 lignes et 200 colonnes. Avec les âges en lignes et les taux de prévalence par âge en colonne pour chaque itération
# SUMMARY_TX_PREV : matrice 61 lignes et 4 colonnes. Avec l'âge en ligne et les quantiles à 2,5%, à 97,5% et la moyenne pour les taux de prévalence en colonne pour chaque âge


# Intervalle de confiance pour les espérances de vie à 35 ans
esperance_de_vie <- read.csv("esperance_vie_iterations")
esperance_de_vie$X <- NULL
colnames(esperance_de_vie) <- gsub("X","",colnames(esperance_de_vie))

esperance_de_vie_bonne_sante <- read.csv("esperance_vie_bonne_sante_iterations")
esperance_de_vie_bonne_sante$X <- NULL
colnames(esperance_de_vie_bonne_sante) <- gsub("X","",colnames(esperance_de_vie_bonne_sante))


mean(esperance_de_vie$esperance_vie)                                   # calcul de l'espérance de vie à 35 ans moyenne
mean(esperance_de_vie_bonne_sante$esperance_vie_bonne_sante)           # calcul de l'espérance de vie en bonne santé à 35 ans moyenne

quantile(esperance_de_vie$esperance_vie,probs=c(0.025,0.975))                            # calcul des quantiles à 2,5% et 97,5% pour l'espérance de vie à 35 ans
quantile(esperance_de_vie_bonne_sante$esperance_vie_bonne_sante,probs=c(0.025,0.975))    # calcul des quantiles à 2,5% et 97,5% pour l'espérance de vie en bonne santé à 35 ans


# Intervalle de confiance pour les prévalences par âge
PREV <- read.csv("prev_iterations")
PREV$X <- NULL
colnames(PREV) <- gsub("X","",colnames(PREV))
PREV <- PREV[1:61,]

SUMMARY_PREV <- data.frame(matrix(nrow=61,ncol=4))

for(a in 1:nrow(PREV)){
  age <- PREV[a,2:200]
  moy <- rowMeans(age)
  quantile <- quantile(age,probs=c(0.025,0.975))
  q1 <- quantile[1]
  q2 <- quantile[2]
  
  SUMMARY_PREV[a,1] <- a+34
  SUMMARY_PREV[a,2] <- q1
  SUMMARY_PREV[a,3] <- moy
  SUMMARY_PREV[a,4] <- q2
}
colnames(SUMMAR_PREV) <- c("age","q_2.5","moyenne","q_97.5")


# Graphique : 
library(ggplot2)
ggplot(SUM_PREV,aes(age))+
  geom_ribbon(aes(ymin=q_2.5,ymax=q_97.5),fill="grey96")+
  geom_line(aes(y=moyenne,color="moyenne"))+
  geom_line(aes(y=q_97.5,color="Quantile à 97,5%"))+
  geom_line(aes(y=q_2.5,color="Quantile à 2,5%"))+
  theme_classic()+
  labs(y="prévalence")+
  scale_color_manual(values=c("black","grey93","grey90"))



# Intervalle de confiance pour les taux de prévalence par âge
TX_PREV <- read.csv("taux_prev_iterations")
TX_PREV$X <- NULL
colnames(TX_PREV) <- gsub("X","",colnames(TX_PREV))
TX_PREV <- TX_PREV[1:61,]


SUMMARY_TX_PREV <- data.frame(matrix(nrow=61,ncol=4))

for(a in 1:nrow(TX_PREV)){
  age <- TX_PREV[a,2:200]
  moy <- rowMeans(age)
  quantile <- quantile(age,probs=c(0.025,0.975))
  q1 <- quantile[1]
  q2 <- quantile[2]
  
  SUMMARY_TX_PREV[a,1] <- a+34
  SUMMARY_TX_PREV[a,2] <- q1
  SUMMARY_TX_PREV[a,3] <- moy
  SUMMARY_TX_PREV[a,4] <- q2
}
colnames(SUMMARY_TX_PREV) <- c("age","q_2.5","moyenne","q_97.5")


# Graphique :
ggplot(SUM_TX_PREV,aes(age))+
  geom_ribbon(aes(ymin=q_2.5,ymax=q_97.5),fill="grey96")+
  geom_line(aes(y=moyenne,color="moyenne"))+
  geom_line(aes(y=q_97.5,color="Quantile à 97,5%"))+
  geom_line(aes(y=q_2.5,color="Quantile à 2,5%"))+
  theme_classic()+
  labs(y="taux de prévalence (%)")+
  scale_color_manual(values=c("black","grey93","grey90"))


