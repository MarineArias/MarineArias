
### En utilisant le programmde Code_Simulation

## Objectif : récupérer les prévalences par âge pour chaque cohorte pour la population française

# Pop_35 : matrice qui recense le nombre de personne ayant 35 ans pour chaque cohorte de naissance (1 matrice pour chaque sexe)
# proba : matrice 61 lignes et 3 colonnes. Avec les âges en lignes et les P01 et la cohorte de référence en colonnes
# etats : matrice 10 000 lignes et 61 colonnes. Avec les individus en ligne et les âges de 35 à 95 ans en colonne implémentant les différents états de 0, 1, 2 et 3
# PREV_POP :matrice 61 lignes et 3 colonnes. Avec les âges en lignes et les prévalences pour chaque âges ainis que la cohorte de référence en colonnes


## Données 
Pop_35 <- read.csv(file="population_fr_35ans_cohorte_homme.csv",sep=";",dec=",")


### Programme

## Calcul des probabilités de passer de l'état 0 à 35 ans à l'état 1 à l'age a : P01

for(c in 1920:2000){                                # boucle sur les cohortes
  print(c)
  
  proba <- data.frame(matrix(ncol=3,nrow=0))
  
  etats <- read.csv(paste("etats_H",c,sep="_"))
  etats$X <- NULL
  colnames(etats) <- gsub("X","",colnames(etats))
  
  for(age in 35:95){
    nb <- 0
    for(i in 1:nrow(etats)){                      # calcul de la prévalence
      if(etats[i,age-34] == 1){
        nb = nb +1
      }
      if(etats[i,age-34] ==3){
        nb = nb + 0.5
      }
    }
    p <- nb/10000                                   # calcul de la probabilité P01
    ligne <- c(age,c,p)
    proba <- rbind(proba,ligne)
  }
  colnames(proba) <- c("age","cohorte","nb_1_3")
  write.csv(proba,file=paste("proba",c,sep="_"))
}


for(c in 1920:2000){                                # boucle sur les cohortes
  
  PREV_POP <- data.frame(matrix(nrow=0,ncol=3))
  
  proba <- read.csv(paste("proba",c,sep="_"))       # lecture de la matrice contenant les probabilités
  proba$X <- NULL
  colnames(proba) <- gsub("X","",colnames(proba))
  
  for(age in 35:95){
    pop <- proba[age-34,3]*Pop_35[c-1919,2]         # calcul du nombre de personne malade à chaque âge a pour la cohorte c
    
    ligne <- c(age,c,pop)
    PREV_POP <- rbind(PREV_POP,ligne)
  }
  colnames(PREV_POP) <- c("age","cohorte","prevalence")
  write.csv(PREV_POP,file=paste("PREV_POP",c,sep="_"))
}


