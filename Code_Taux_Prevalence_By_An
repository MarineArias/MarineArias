

### En utilisant les programmes Code_Simulation et Code_Prevalence_By_An

## Objectif : calculer les taux de prévalence par âge pour chaque année

# etats :  matrice de 10 000 lignes et 61 colonnes. Avec les individus en ligne et les âges de 35 à 95 ans en colonne implémentant les différents états de 0, 1, 2 et 3
# PREV_BY_AN : matrice de 61 lignes et 4 colonnes. Avec les âges en ligne et la prévalence et le nombre de vivants pour chaque âge en colonne (pour chaque année)
# taux_prev_by_an : matrice de 61 lignes et 3 colonnes. Avec les âges en ligne et l'année de référence et le taux de prévalence pour chaque âge en colonne (pour chaque année)


for(an in 2015:2035){                                             # boucle sur les années
  
  print(an)
  
  taux_prev_by_an <- data.frame(matrix(ncol=3,nrow=0))
  
  PREV_BY_AN <- read.csv(paste("prevalence_by_an",an,sep="_"))    # lecture de la matrice des prévalences pour l'année an
  PREV_BY_AN$X <- NULL
  colnames(PREV_BY_AN) <- gsub("X","",colnames(PREV_BY_AN))
  PREV_BY_AN <- PREV_BY_AN[order(PREV_BY_AN$age),]
  
  for(a in 36:95){                                                # calcul du taux de prévalence
    prev <- PREV_BY_AN[a-35,3]
    vivants <- PREV_BY_AN[a-35,4]

    tx <- (prev/vivants)*100
    ligne <- c(a,an,tx)
    taux_prev_by_an <- rbind(taux_prev_by_an,ligne)
  }
  colnames(taux_prev_by_an) <- c("age","annee","taux_de_prevalence")
  write.csv(taux_prev_by_an,file=paste("taux_prev_by_an",an,sep="_"))
}
